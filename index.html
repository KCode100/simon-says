<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simon Says</title>

    <style>
        body {
            background-color: #f9f9f9;
            color: #777;
        }
        .btn {
            padding: 30px 50px;
            font-size: 24px;
            text-align: center;
            display: inline-block;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, .6);
            border-radius: 3px;
        }
        .btn--1 {
            background-color: rgb(134, 0, 0);
        }
        .btn--2 {
            background-color: rgb(146, 146, 1);
        }
        .btn--3 {
            background-color: green;
        }
        .btn--4 {
            background-color: rgb(0, 0, 153);
        }
        .command {
            text-transform: uppercase;
        }

    </style>
</head>
<body>

    <audio class="sound" src="./assets/mp3/simonsound1.mp3" type = "audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio class="sound" src="./assets/mp3/simonsound2.mp3" type = "audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio class="sound" src="./assets/mp3/simonsound3.mp3" type = "audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio class="sound" src="./assets/mp3/simonsound4.mp3" type = "audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <h2 class="command"></h2>
    <div class="btns-container">
        <div class="btn btn--1" id="1">1</div>
        <div class="btn btn--2" id="2">2</div>
        <div class="btn btn--3" id="3">3</div>
        <div class="btn btn--4" id="4">4</div>
    </div>

    <div class="score">Score: <span id = "score">0</span></div>

    <button class="start-btn">Play</button>
    <div class="game-over" hidden>
        Game over!
        restart
    </div>
    <button class="speed-btn slow">slow</button>
    <button class="speed-btn normal">normal</button>
    <button class="speed-btn fast">fast</button>
    <button class="mute">Mute</button>

    <script>

        const commandEl = document.querySelector('.command');
        const btnsContainer = document.querySelector('.btns-container');
        const btnsEl = document.querySelectorAll('.btn');
        const startEl = document.querySelector('.start-btn');
        const gameOverEl = document.querySelector('.game-over');
        const speedBtnsEl = document.querySelectorAll('.speed-btn');
        const slowEl = document.querySelector('.slow');
        const normalEl = document.querySelector('.normal');
        const fastEl = document.querySelector('.fast');
        const soundEl = document.querySelector('.mute');
        const scoreEl = document.getElementById('score');
        const sounds = document.querySelectorAll('.sound');
        const slow = 1000;
        const normal = 700;
        const fast = 400;
        
        let userTurn = false;
        let comp = [];
        let user = [];
        let chosenSpeed = normal;
        let score = 0;
        let sound = 'on';
        
        // listen to btns and flash
        btnsEl.forEach(btn => btn.addEventListener('click', (e) => {
            if (userTurn) {
                const curr = e.target;
                curr.style.filter = "brightness(2)";
                setTimeout(()=>{
                    curr.style.filter = "brightness(1)";
                }, 300);
            }
        }));
        
        //  TOGGLE SOUND
        function toggleSound(el) {
            if (sound === 'on') {
                document.querySelectorAll('audio').forEach(el => {
                    el.muted = true;
                    sound = 'off';
                });
            } else if (sound === 'off') {
                console.log('turningon');
                document.querySelectorAll('audio').forEach(el => {
                    el.muted = false;
                    sound = 'on';
                });
            }
        }        

        // INITIATE COMPUTERS PATTERN
        function getRandom() {
            const random = btnsEl [ Math.floor (Math.random () * btnsEl.length)];
            comp.push (random);
        }

        // FLASH CURRENT ITEM
        function flash(item, index) {
            item.style.filter = "brightness(2)";
            setTimeout(()=>{
                item.style.filter = "brightness(1)";
            }, 250);

            // PLAY CORRESPONDING SOUND
            const currentElement = parseInt(item.id) - 1;
            sounds[currentElement].play();

            // UPDATE COMMAND WHEN SET IS OVER
            if (index === comp.length - 1) {
                setTimeout(()=> {
                    updateCommand('play');
                }, 800);
            }
        }
        
        // ADD GAP BETWEEN FLASHES
        function pause(item, index) {
            gap = index * chosenSpeed;
            setTimeout(() => {
                flash(item, index)
            }, gap);
            
        }

        // SHOW COMMAND
        function updateCommand(command) {
            commandEl.innerHTML = `${command}!`;
        }

        // LOOP THROUGH COMPUTERS PATTERN
        function displayOrder() {
            for (i = 0; i < comp.length; i++) {
                pause(comp[i], i);
            }
            
            userTurn = true;
            }

            // STILL IN THE GAME
            function continueGame() {
            removeStartBtn();
            user = [];
            getRandom();
            updateCommand('watch');
            setTimeout(()=> {
                displayOrder();
            }, 1000);
        }
        
        // RESET PATTERNS
        function resetPatterns() {
            comp = [];
            user = [];
        }

        // RESET CURRENT SCORE
        function resetScore() {
            scoreEl.innerHTML = 0;
        }

        // SHOW START BTN
        function showStartBtn() {
            startEl.hidden = false;
        }

        // HIDE START BTN
        function removeStartBtn() {
            startEl.hidden = true;
        }

        // GAME OVER
        function gameOver() {
            userTurn = false;
            gameOverEl.hidden = false;
        }

        // HIDE GAME OVER EL
        function hideGameOver() {
            gameOverEl.hidden = true;
        }

        // HARD RESET
        function newGame() {
            hideGameOver();
            showStartBtn();
            resetPatterns();
            resetScore();
            userTurn = false;
        }

        // SHOW CURRENT SCORE
        function updateScoreBoard() {
            scoreEl.innerHTML = score;
        }
        
        // CHOSEN SPEED
        window.addEventListener('click', function(e){
            if(e.target === fastEl) {
                chosenSpeed = fast;
            } else if (e.target === normalEl) {
                chosenSpeed = normal;
            } else if (e.target === slowEl) {
                chosenSpeed = slow;
            }

        // USERS INPUT
            if (userTurn && e.target.classList.contains('btn')) {

                // SAVE INPUT
                user.push(e.target);
                const length = user.length;
                const currRound = length - 1;

                // PLAY CORRESPONDING SOUND
                const currentElement = parseInt(e.target.id) - 1;
                sounds[currentElement].play();
                
                // IF USER'S CORRECT
                if (user[currRound] === comp[currRound]) {
                    // ADD SCORE
                    score ++;
                    updateScoreBoard();

                    // IF COMPLETED SET
                    if (user.length === comp.length) {
                        userTurn = false;
                        setTimeout(()=>{
                            continueGame();
                        }, 200);
                    }

                // IF USER'S INCORRECT
                } else {
                    gameOver();
                }
            }
        });

        // EVENT LISTENERS
        speedBtnsEl.forEach(btn => btn.addEventListener('click', newGame));
        startEl.addEventListener('click', continueGame);
        soundEl.addEventListener('click', toggleSound);
        gameOverEl.addEventListener('click', continueGame);

        // FUTURE ADDITIONS
        // => LEADER BOARD TABLE - NAME & SCORE
        // => LOCAL STORAGE
        // => KEYBOARD ARROWS TO SELECT BTNS
    </script>
</body>
</html>
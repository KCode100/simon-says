<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simon Says</title>

    <style>
        body {
            background-color: #f9f9f9;
            color: #777;
        }
        .btn {
            padding: 30px 50px;
            margin: 30px;
            font-size: 24px;
            text-align: center;
            display: inline-block;
            background-color: white;
            box-shadow: 0 1px 5px rgba(0, 0, 0, .6);
            border-radius: 3px;
        }

    </style>
</head>
<body>

    <audio class="sound sound1" src="./assets/mp3/simonsound1.mp3" type = "audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio class="sound sound2" src="./assets/mp3/simonsound2.mp3" type = "audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio class="sound sound3" src="./assets/mp3/simonsound3.mp3" type = "audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <audio class="sound sound4" src="./assets/mp3/simonsound4.mp3" type = "audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <h2 class="command"></h2>
    <div class="btns-container">
        <div class="btn" id="1">1</div>
        <div class="btn" id="2">2</div>
        <div class="btn" id="3">3</div>
        <div class="btn" id="4">4</div>
    </div>

    <div class="score">Score: <span id = "score">0</span></div>

    <button class="start-btn">Start</button>
    <button class="speed-btn slow">slow</button>
    <button class="speed-btn normal">normal</button>
    <button class="speed-btn fast">fast</button>
    <button class="mute">Mute</button>

    <script>

        const commandEl = document.querySelector('.command');
        const btnsContainer = document.querySelector('.btns-container');
        const btnsEl = document.querySelectorAll('.btn');
        const startEl = document.querySelector('.start-btn');
        const speedBtnsEl = document.querySelectorAll('.speed-btn');
        const slowEl = document.querySelector('.slow');
        const normalEl = document.querySelector('.normal');
        const fastEl = document.querySelector('.fast');
        const soundEl = document.querySelector('.mute');
        const scoreEl = document.getElementById('score');
        const sounds = document.querySelectorAll('.sound');
        const slow = 1000;
        const normal = 700;
        const fast = 400;
        
        let userTurn = false;
        let comp = [];
        let user = [];
        let chosenSpeed = normal;
        let score = 0;
        let sound = 'on';
        
        // listen to btns and flash
        btnsEl.forEach(btn => btn.addEventListener('click', (e) => {
            if (userTurn) {
                const curr = e.target;
                curr.style.backgroundColor = 'orangered';
                setTimeout(()=>{
                    curr.style.backgroundColor = 'white';
                }, 300);
            }
        }));
        
        //  TOGGLE SOUND
        function toggleSound(el) {
            if (sound === 'on') {
                document.querySelectorAll('audio').forEach(el => {
                    el.muted = true;
                    sound = 'off';
                });
            } else if (sound === 'off') {
                console.log('turningon');
                document.querySelectorAll('audio').forEach(el => {
                    el.muted = false;
                    sound = 'on';
                });
            }
        }        

        // INITIATE COMPUTERS PATTERN
        function getRandom() {
            const random = btnsEl [ Math.floor (Math.random () * btnsEl.length)];
            comp.push (random);
        }

        // FLASH CURRENT ITEM
        function flash(item, index) {
            item.style.backgroundColor = 'orangered';
            setTimeout(()=>{
                item.style.backgroundColor = 'white';
            }, 250);

            // PLAY CORRESPONDING SOUND
            const currentElement = parseInt(item.id) - 1;
            sounds[currentElement].play();
        }
        
        // ADD GAP BETWEEN FLASHES
        function pause(item, index) {
            gap = index * chosenSpeed;
            setTimeout(() => {
                flash(item, index)
            }, gap)
        }

        // LOOP THROUGH COMPUTERS PATTERN
        function displayOrder() {
            for (i = 0; i < comp.length; i++) {
                pause(comp[i], i);
            }
            userTurn = true;
        }

        // STILL IN THE GAME
        function continueGame() {
            user = [];
            getRandom();
            displayOrder();
        }
        
        // RESET PATTERNS
        function resetPatterns() {
            comp = [];
            user = [];
        }

        // RESET CURRENT SCORE
        function resetScore() {
            scoreEl.innerHTML = 0;
        }

        // HARD RESET
        function newGame() {
            resetPatterns();
            resetScore();
        }

        // SHOW CURRENT SCORE
        function updateScoreBoard() {
            scoreEl.innerHTML = score;
        }
        
        // CHOSEN SPEED
        window.addEventListener('click', function(e){
            if(e.target === fastEl) {
                chosenSpeed = fast;
            } else if (e.target === normalEl) {
                chosenSpeed = normal;
            } else if (e.target === slowEl) {
                chosenSpeed = slow;
            }

        // USERS INPUT
            if (userTurn && e.target.classList.contains('btn')) {

                // SAVE INPUT
                user.push(e.target);
                const length = user.length;
                const currRound = length - 1;

                // PLAY CORRESPONDING SOUND
                const currentElement = parseInt(e.target.id) - 1;
                sounds[currentElement].play();
                
                // IF USER'S CORRECT
                if (user[currRound] === comp[currRound]) {
                    // ADD SCORE
                    score ++;
                    updateScoreBoard();

                    // IF COMPLETED SET
                    if (user.length === comp.length) {
                        userTurn = false;
                        setTimeout(()=>{
                            continueGame();
                        }, 1000);
                    }

                // IF USER'S INCORRECT
                } else {
                    userTurn = false;
                }
            }
        });

        // EVENT LISTENERS
        speedBtnsEl.forEach(btn => btn.addEventListener('click', newGame));
        startEl.addEventListener('click', continueGame);
        soundEl.addEventListener('click', toggleSound);

        // FUTURE ADDITIONS
        // => LEADER BOARD TABLE - NAME & SCORE
        // => LOCAL STORAGE
        // => KEYBOARD ARROWS TO SELECT BTNS
    </script>
</body>
</html>